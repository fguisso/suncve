{"cveId": "CVE-2023-41330", "cwe": ["CWE-502", "CWE-502", "CWE-502"], "cvss": [{"baseScore": "9.8", "version": "3.1", "Attack Vector": "None", "Attack Complexity": "Low", "Privileges Required": "None", "User Interaction": "None", "Scope": "Unchaged", "Confidentiality Impact": "High", "Integrity Impact": "High", "Availability Impact": "High"}], "references": ["https://github.com/KnpLabs/snappy/security/advisories/GHSA-92rv-4j2h-8mjj", "https://github.com/KnpLabs/snappy/security/advisories/GHSA-gq6w-q6wh-jggc", "https://github.com/KnpLabs/snappy/commit/d3b742d61a68bf93866032c2c0a7f1486128b67e"], "description": ["knplabs/knp-snappy is a PHP library allowing thumbnail, snapshot or PDF generation from a url or a html page.\n## Issue\n\nOn March 17th the vulnerability CVE-2023-28115 was disclosed, allowing an attacker to gain remote code execution through PHAR deserialization. Version 1.4.2 added a check `if (\\strpos($filename, 'phar://') === 0)` in the `prepareOutput` function to resolve this CVE, however if the user is able to control the second parameter of the `generateFromHtml()` function of Snappy, it will then be passed as the `$filename` parameter in the `prepareOutput()` function. In the original vulnerability, a file name with a `phar://` wrapper could be sent to the `fileExists()` function, equivalent to the `file_exists()` PHP function. This allowed users to trigger a deserialization on arbitrary PHAR files. To fix this issue, the string is now passed to the `strpos()` function and if it starts with `phar://`, an exception is raised. However, PHP wrappers being case insensitive, this patch can be bypassed using `PHAR://` instead of `phar://`. A successful exploitation of this vulnerability allows executing arbitrary code and accessing the underlying filesystem. The attacker must be able to upload a file and the server must be running a PHP version prior to 8. This issue has been addressed in commit `d3b742d61a` which has been included in version 1.4.3. Users are advised to upgrade. Users unable to upgrade should ensure that only trusted users may submit data to the `AbstractGenerator->generate(...)` function.\n"], "published": "2023-09-06T18:15:09.153", "state": "PUBLIC", "vendorName": ["KnpLabs"], "productName": ["snappy"], "github": {"advisories": ["https://github.com/KnpLabs/snappy/security/advisories/GHSA-92rv-4j2h-8mjj", "https://github.com/KnpLabs/snappy/security/advisories/GHSA-gq6w-q6wh-jggc"], "commits": ["https://github.com/KnpLabs/snappy/commit/d3b742d61a68bf93866032c2c0a7f1486128b67e"], "pocAdvisorie": {"url": "https://github.com/KnpLabs/snappy/security/advisories/GHSA-92rv-4j2h-8mjj", "kw": ["poc", "proof of concept"]}, "repo": "https://github.com/KnpLabs/snappy/", "info": {"exist": true, "topics": ["hacktoberfest", "html-to-image", "html-to-pdf", "image-generation", "pdf-generation", "php"], "langs": {"PHP": 89610}, "avatar": "https://avatars.githubusercontent.com/u/202732?v=4", "stargazers": 4430, "language": "PHP"}}, "pocList": []}